# glonassd
Сервер для GPS/GLONASS трекеров, работающий в операционной системе Debian.

### Краткое описание
**glonassd** это линукс-демон, принимающий данные от GPS / GLONASS трекеров и сохраняющий их в базу данных.<br>
Демон написан на языке C, собран компилятором gcc 4.9.2 для x86_64-linux-gnu (64-битная версия).

### Протоколы
**Принимаемые:** Arnavi, Galileo (все версии), GPS101-GPS103, SAT-LITE / SAT-LITE2, Wialon IPS, Wialon NIS (SOAP / Олимпстрой), ЕГТС (ЭРА-ГЛОНАСС).<br>
**Передаваемые (пересылка):** все принимаемые без перекодирования или перекодирование в протокол Wialon NIS или ЕГТС.<br>
Протоколы реализованы и могут быть добавлены подключением библиотек без перекомпиляции демона.

### База данных
На текущий момент используется PostgreSQL<br>
БД могут быть добавлены подключением библиотек без перекомпиляции демона.

### Возможности
* Пересылка данных трекеров на сторонние сервера с перекодированием или без него.
* Хранение данных на время обрыва связи со сторонними серверами, отправка после восстановления связи.
* Автоматическое восстановление связи со сторонними серверами в случае её потери.
* Максимальное количество ретрансляций: до 3 серверов для каждого терминала.
* Выполнение задач (скриптов) по расписанию (таймеру), максимально 5 таймеров.
* Простая настройка двумя .conf файлами.
* Возможность добавления протоколов терминалов или баз данных подключаемыми библиотеками без перекомпиляции демона.

### Компиляция
**make all** компиляция демона + библиотеки БД + библиотеки терминалов<br>
**make glonassd** компиляция только демона без библиотек<br>
**make pg** компиляция библиотеки базы данных (PostgreSQL)<br>
**make name** компиляция библиотеки протокола терминала **name**

**Замечание:** если происходит ошибка "/usr/bin/ld: cannot find -lpq", выполнить команду: **apt-get install libpq-dev**

### Установка
Создать папку для демона и скопировать в неё файлы **glonassd, \*.so, \*.sql**, или использовать папку сборки демона.<br>
Создать папки **forward** и **logs** в папке демона.<br>
В базе данных PostgreSQL создать таблицу "tgpsdata" (см. скрипт tgpsdata.sql).<br>
Если работает фаерволл, разрешить входящие подключения на портах демона (см. файл glonassd.conf).

### Настройка
В файле **glonassd.conf** в секции **server** изменить значения параметров:<br>
**listen** - IP адрес входящих подключений<br>
**transmit** - IP адрес с которого производится ретрансляция<br>
**log_file** - полный путь к лог-файлу<br>
**db_host, db_port, db_name, db_schema, db_user, db_pass** - параметры подключения к БД PostgreSQL<br>
Закомментировать или раскомментировать секции протоколов терминалов в зависимости от используемых и указать порты для подключения терминалов.

Для включения ретрансляции терминалов изучить комментарии в секции **forward** в файле **glonassd.conf**.<br>
Для включения задач по расписанию изучить комментарии к параметру **timer** в секции **server** в файле **glonassd.conf**.

### Запуск
Командой **./glonassd start** из папки с демоном, параметры **stop** или **restart** для остановки или перезапуска.<br>
Параметр -c path/to/config/file используется для указания файла настроек, находящегося в другой папке.<br>
Если демон уже настроен для автоматического старта, команды **service glonassd start** и **service glonassd stop** запускают и останавливают сервис.

### Автозапуск при старте системы
Отредактировать значение переменной **DAEMON** в файле **glonassd.sh**, указав полный путь к файлу **glonassd**.<br>
Cкопировать файл **glonassd.sh** в папку **/etc/init.d**.<br>
Сделать этот файл исполняемым командой **chmod 0755 /etc/init.d/glonassd.sh**.<br>
Командами **systemctl daemon-reload** и **update-rc.d glonassd.sh defaults** разрешить автоматический запуск демона.<br>

### Отключить автозапуск при старте системы
Командой **update-rc.d -f glonassd.sh remove** запретить автоматический запуск демона без удаления файла glonassd.sh.<br>
Удалить файл /etc/init.d/glonassd.sh и командой **systemctl daemon-reload** очистить информацию о демоне в системе.

### Лицензия
glonassd это открытое ПО под лицензией [MIT](http://licenseit.ru/wiki/index.php/MIT_License).

### Документация и API
[Документация](https://github.com/fandrej/glonassd/wiki) в процессе написания.

### Автор
Федоров Андрей, Курган, Россия.<br>
<mailto:mail@locman.org>

### Эпилог
Демон glonassd это часть навигационного сервиса [locman.org](http://locman.org/map/index.php).
